DROP TABLE IF EXISTS P_ORDER_STATE_HISTORY;
DROP TABLE IF EXISTS P_ORDER_DETAILS;
DROP TABLE IF EXISTS P_ORDERS;

CREATE TABLE P_ORDERS
(
    ORDER_ID            BIGINT GENERATED BY DEFAULT AS IDENTITY
        PRIMARY KEY,
    ORDER_UUID          VARCHAR(36)           NOT NULL,
    ORDER_STATE         VARCHAR(9)            NOT NULL
        CONSTRAINT P_ORDERS_ORDER_STATE_CHECK
        CHECK (ORDER_STATE IN ('PENDING', 'CREATED', 'SHIPPED', 'DELIVERED', 'CONFIRMED', 'CANCELLED')),
    ORDER_DATE          TIMESTAMP(6)          NOT NULL,
    RECEIVER_COMPANY_ID VARCHAR(255)          NOT NULL,
    SUPPLIER_COMPANY_ID VARCHAR(255)          NOT NULL,
    TOTAL_AMOUNT        BIGINT                NOT NULL,
    TOTAL_QUANTITY      BIGINT                NOT NULL,
    IS_PUBLIC           BOOLEAN DEFAULT TRUE  NOT NULL,
    IS_DELETE           BOOLEAN DEFAULT FALSE NOT NULL,
    CREATED_AT          TIMESTAMP(6),
    CREATED_BY          VARCHAR(255),
    UPDATED_AT          TIMESTAMP(6),
    UPDATED_BY          VARCHAR(255),
    DELETED_AT          TIMESTAMP(6),
    DELETED_BY          VARCHAR(255)
);

CREATE TABLE P_ORDER_DETAILS
(
    ORDER_DETAIL_ID   BIGINT GENERATED BY DEFAULT AS IDENTITY
        PRIMARY KEY,
    ORDER_DETAIL_UUID VARCHAR(36)           NOT NULL,
    ORDER_ID          BIGINT                NOT NULL,
    PRODUCT_ID        VARCHAR(255)          NOT NULL,
    PRODUCT_NAME      VARCHAR(255)          NOT NULL,
    QUANTITY          BIGINT                NOT NULL,
    UNIT_PRICE        BIGINT                NOT NULL,
    IS_PUBLIC         BOOLEAN DEFAULT TRUE  NOT NULL,
    IS_DELETE         BOOLEAN DEFAULT FALSE NOT NULL,
    CREATED_AT        TIMESTAMP(6),
    CREATED_BY        VARCHAR(255),
    UPDATED_AT        TIMESTAMP(6),
    UPDATED_BY        VARCHAR(255),
    DELETED_AT        TIMESTAMP(6),
    DELETED_BY        VARCHAR(255)
);

CREATE TABLE P_ORDER_STATE_HISTORY
(
    ORDER_STATE_HISTORY_ID BIGINT GENERATED BY DEFAULT AS IDENTITY
        PRIMARY KEY,
    ORDER_ID               BIGINT                NOT NULL,
    ORDER_STATE            VARCHAR(9)            NOT NULL
        CONSTRAINT P_ORDER_STATE_HISTORY_ORDER_STATE_CHECK
        CHECK (ORDER_STATE IN ('PENDING', 'CREATED', 'SHIPPED', 'DELIVERED', 'CONFIRMED', 'CANCELLED')),
    IS_PUBLIC              BOOLEAN DEFAULT TRUE  NOT NULL,
    IS_DELETE              BOOLEAN DEFAULT FALSE NOT NULL,
    CREATED_AT             TIMESTAMP(6),
    CREATED_BY             VARCHAR(255),
    UPDATED_AT             TIMESTAMP(6),
    UPDATED_BY             VARCHAR(255),
    DELETED_AT             TIMESTAMP(6),
    DELETED_BY             VARCHAR(255)
);
